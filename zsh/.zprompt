#!/bin/zsh

function zprompt_user {
  if [[ ${UID} == 0 ]]; then
    echo "#"
  else
    echo "%%"
  fi
}

function zprompt_shortpwd {
  local usr=$(whoami)
  local pth=$(echo ${PWD} | sed "s/^\(\/home\)\?\/${usr}/~/")
  local lst=( "${(s:/:)${pth}}" )
  local short=""
  for i in ${lst}; do
    [[ ${i} != "~" ]] && short+="/"
    if [[ ${i:0:1} == "." ]]; then
      short+="${i:0:2}"
    else
      short+="${i:0:1}"
    fi
  done
  echo $short
}

function zprompt_git_status {
  local git_status=$(git status --porcelain 2> /dev/null)
  [[ -n ${git_status} ]] && echo "*"
}

function zprompt_git_branch {
  local git_branch=$(git symbolic-ref HEAD --short 2> /dev/null)
  [[ -n ${git_branch} ]] && echo " ${git_branch} "
}

setopt prompt_subst

PROMPT="%m:"
PROMPT+='$(zprompt_shortpwd)'
PROMPT+='$(zprompt_git_branch)'
PROMPT+='$(zprompt_git_status)'
PROMPT+=' $(zprompt_user) '
